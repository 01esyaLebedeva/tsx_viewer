app-id: io.github.01esyaLebedeva.tsx_viewer

runtime: org.freedesktop.Platform
runtime-version: '23.08'   # актуальная стабильная версия runtime Freedesktop
sdk: org.freedesktop.Sdk
command: tsx-viewer

modules:
  - name: nodejs
    buildsystem: simple
    sources:
      - type: archive
        url: https://nodejs.org/dist/v18.16.0/node-v18.16.0.tar.xz
        sha256: c3601f9b8cf9674ac0ebb3f6611a5e515beee652ea9ffae8b4d63374a24eb05a
    build-commands:
      - ./configure --prefix=/app
      - make
      - make install

  - name: tsx_viewer
    buildsystem: simple
    build-commands:
      - npm install  # установит все зависимости из package.json
      - npm run build  # сборка production версии React приложения
      - mkdir -p /app/share/tsx_viewer
      - cp -r build/* /app/share/tsx_viewer/   # копируем собранные файлы

    sources:
      - type: git
        url: https://github.com/01esyaLebedeva/tsx_viewer.git
        tag: main
        commit: 43edb51e9cffc65f0c83018c974975fb8c0181c8  # укажите конкретный коммит или тег

finish-args:
  - --share=network
  - --socket=x11
  - --socket=wayland

# Файл запуска (исполняемый файл) — для простого React-приложения
# можно создать скрипт-оболочку запускающий локальный сервер или запускать статический сервер,
# например с помощью 'serve' или 'http-server' из npm пакета
# либо просто открыть index.html в браузере.
#
# Здесь пример копирования bash скрипта запуска в /app/bin/tsx-viewer

  - name: run-script
    buildsystem: simple
    sources:
      - type: script
        dest-filename: run.sh
        commands:
          - echo '#!/bin/sh'
          - echo 'xdg-open /app/share/tsx_viewer/index.html' 
          - chmod +x run.sh
    build-commands:
      - install run.sh /app/bin/tsx-viewer